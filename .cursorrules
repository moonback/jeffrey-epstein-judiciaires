# üß† Cursor Rules - DOJ Forensic Analyzer

## üïµÔ∏è Project Context
The **Analyseur de Documents Judiciaires** (DOJ Forensic) is a high-performance OSINT and forensic platform. It uses AI (Gemini 2.0) to transform dense legal disclosures into a visual and structured database. The goal is to identify connections, financial flows, and legal contradictions.

## üõ†Ô∏è Technical Stack
- **Frontend**: React 19 (Hooks, Concurrent Mode), Vite, TypeScript (Strict).
- **Styling**: Tailwind CSS 4, Custom CSS (Glassmorphism, Forensic Lab Aesthetic).
- **Database**: Supabase (Remote Sync) + IndexedDB (`idb` library for local cache).
- **AI**: OpenRouter API (Gemini 2.0 Flash Lite), Tesseract.js (OCR).
- **Visualization**: `react-force-graph-2d` for network mapping.

## üìè Code Style & Conventions
- **Naming**:
  - Components: `PascalCase` (e.g., `DataCard.tsx`).
  - Functions/Variables: `camelCase` (e.g., `handleNewAnalysis`).
  - Constants: `UPPER_SNAKE_CASE` (e.g., `DEFAULT_MODEL`).
  - CSS: Tailwind first; custom CSS only for specialized animations or gradients.
- **File Organization**:
  - `components/`: UI/UX Views and Atomic Components.
  - `services/`: Business logic, API clients, and Storage handlers.
  - `types.ts`: Central truth for all TypeScript interfaces.
  - `constants.ts`: System prompts and immutable config.
- **React Patterns**:
  - Always use Functional Components with TypeScript interfaces.
  - Favor `useMemo` for heavy components (Graphs, Timelines).
  - Use `useOptimistic` for immediate UI response during database sync.

## üèóÔ∏è Architectural Patterns
- **Service Isolation**: No direct `fetch` in components. Use `openRouterService` or `storageService`.
- **Local-First**: Always write to IndexedDB first. Sync to Supabase is secondary and non-blocking.
- **State Flow**: Centralized state in `App.tsx` for Queue and History. Prop-drill carefully or use Context only if necessary.

## üõ°Ô∏è Best Practices
- **Type Safety**: No `any`. If a type is unknown from an API, use `unknown` and validate.
- **AI Integration**: Always validate JSON blocks extracted from LLM responses using `sanitizeJsonBlock`.
- **Security**:
  - Use `import.meta.env.VITE_*` for environment variables.
  - Pass sensitive keys through the `SettingsModal` flow rather than hardcoding.
- **UX**: All interactions must feel "Premium Forensic" (smooth transitions, pulse animations on active tasks, precise typography).

## üöÄ Common Workflows
- **Adding a View**: Add to `ViewType` in `Sidebar.tsx`, update `currentView` logic in `App.tsx`, and create the component in `components/`.
- **Extending Analysis**: Modify the `SYSTEM_INSTRUCTION_DISCLOSURE` in `constants.ts` and update the relevant interfaces in `types.ts`.
- **Mobile Support**: Use `lg:` and `xl:` prefixes to handle complex desktop views (Graphs) while providing simplified list/card views for mobile.

## üõë Things to Avoid
- Avoid mutating state directly (use setters).
- Do not add heavy dependencies (e.g., Moment.js, Lodash) for simple tasks.
- Avoid cluttered components; if a file exceeds 400 lines, extract sub-components.
- Do not let the AI output free-text; strictly enforce JSON via system instructions.

## üìÑ Documentation Requirements
- JSDoc for complex service methods.
- Keep `ROADMAP.md` updated with new features.
- Update `DB_SCHEMA.md` if table structures change.
